---
title: "Polarised pandemic response: a comparison of Democrat and Republican leadership
  responses to the COVID-19 pandemic in the US"
author: "Courtney Morgan (csmorgan@umich.edu), Haihan Zhang (hhzhang@umich.edu) and
  Soumik Purkayastha (soumikp@umich.edu)"
date: ''
output:
  html_document: default
  pdf_document: default
link-citations: yes
subtitle: "BIOSTAT 625 term project"
bibliography: biblio.bibtex
---

<style>
body {
text-align: justify}
</style>

<style type="text/css">
.main-container {
  max-width: 1200px;
  margin-left: auto;
  margin-right: auto;
}
</style>



<style type="text/css">

body, td {
   font-size: 18px;
}
code.r{
  font-size: 18px;
}
pre {
  font-size: 18px
}
</style>


 <hr style="height:2px;border-width:2px;color:black;background-color:black"> 

# Abstract

## _Introduction_
The impact of political affiliation in leading the fight against the spread of COVID-19 has been a hotly-debated issue in the United States with sparse empirical evidence. We aim to assess how political affiliation of state governors affected the state's  ability to control the pandemic. 

## _Methods_
We evaluate mean and median time-varying reproductive numbers for the 50 United States and Washington D.C. by means of graphical devices and 2-sample bootstrap-based comparisons. In addition to this unadjusted analysis, we control for variation in population and public health-preparedness prior to onset of the pandemic to investigate if political affiliation of a state's governor had any significant association with the spread of pandemic in the United States. By means of a principal component analysis, we incorporate information from six Public Health Index (PHI) scores into a linear regression framework.   

## _Results_
The difference (Republican - Democrat) in means for mean time-varying reproductive numbers is (1.1649-1.1722), with 95% bootstrap confidence interval (−0.017, 0.031). Similarly, the difference in medians for median time-varying reproductive numbers is (1.0812-1.063), with 95% bootstrap confidence interval (−0.042, 0.006). Treating mean time varying $R(t)$ as the response and adjusting for population density, PHI scores and gender of governor, the estimated coefficient of political affiliation  of governor (case group: Republican, control group: Democrat) is 0.04	(95% CI: -0.52 to 0.60).

## _Conclusion_
While there may be latent confounding factors, our analysis does not show political affiliation of state governors to be significantly associated with control of the pandemic in the United States. 

 <hr style="height:2px;border-width:2px;color:black;background-color:black"> 
 
 
# 1. Introduction
 
Coronavirus disease 2019 (COVID-19) is a contagious disease caused by severe acute respiratory syndrome coronavirus 2 (SARS-CoV-2). New cases of COVID-19 are increasing rapidly at astonishing rates globally; as of December 2020, more than 67 million cases have been detected, which have led to more than 1.5 million fatalities [@wiki2020covid] The volume and speed of data generation in biomedical literature, social media, and other resources during the COVID-19 pandemic is unprecedented [@hechenbleikner2020data] and presents a massive stress test with many unexpected opportunities for data science. Collaborating with researchers from various other fields, data scientists have been instrumental in tracking the contagion and trying to make sense of its many challenges.
 
Many articles have shown the interest in investigating the relationship between leadership and response patterns to the pandemic, and have led to political and social implications. Americans have changed their behavior in ways that would have been unthinkable even a few months ago. Masks are an essential accessory. Social distancing is the norm. And even as states moved to reopen their economies in May and June, many Americans continued to think it was better for people to stay home. But underneath that apparent consensus is a large — and growing — partisan divide. As the number of coronavirus cases surged in many states across the United States, Republicans and Democrats increasingly viewed the disease in starkly different ways, from the personal health risks arising from the coronavirus outbreak to their comfort in engaging in everyday activities. According to recent surveys [@pew2020party], Republicans have consistently been less likely than Democrats to say that they fear being hospitalized because of COVID-19 or that they might unknowingly spread the virus to others. But on the other hand, that partisan gap has widened significantly between April and June. For example, Neelon et. al. revealed the quantitative differences in response strategies between Democrat and Republican-led states in the United States [@neelon2020associations]. 

Another recent study implied that there is a significant and systematic difference by gender of the leader of a region (e.g. a state or country) in various public health metrics for controlling the spread of the pandemic [@garikipati2020leading]. Women leaders reacted more quickly and decisively in the face of potential fatalities through earlier lockdown than male leaders in similar circumstances [@nyt2020women]. This is not a coincidence just in the context of this pandemic. Past studies [@schubert1999financial] have implied that women leaders may be less willing to take risks with lives but more willing to accept risks in relation to the early lockdown of economies [@borghans2009gender]. Based on these findings, subsequent studies have suggested that leadership characteristics other than risk attitudes may also systematically differ between men and women [@eagly1990gender].
 
@purkayastha2020women explored how the  gender of heads of state was associated with the control of the pandemic around the world. The approach relied on comparing $R(t)$ - the effective time-varying reproduction number [@cori2013new] at time $t$ to assess the pandemic control at different time points. Given the imbalance in group sizes (the study compared 19 countries led by women with 140 countries led by men), the authors chose to use resampling techniques to implement a two-group comparison of mean and median values of $R(t)$. No significant association between gender and timely control of the pandemic was reported. We suspect that this unadjusted analysis has been severely affected by confounding factors. For example, population and public health preparedness prior to onset of the pandemic have been revealed to be important factors in how well a region is able to contain spread of the disease. 

In this report, we first explore the relationship between political affiliation of a state governor in the United States and pandemic control through visual inspection and unadjusted statistical inference using simple bootstrap-based group comparisons. Next, we investigate if said association is significant after controlling for gender of governor, public health preparedness and population of state by means a linear regression model. National Health Security Preparedness Index (NHSPI) [@phi2020index]
is a  group of six measures (such as health security surveillance, community planning and engagement and others) that take into account readiness for disease outbreaks. These indices were incorporated into our analysis to control for confounding. 

# 2. Methods

All data we used were from online public resources. We obtained the gender and political affiliation of state governors from [Wikipedia](https://en.wikipedia.org/wiki/List_of_current_United_States_governors). The COVID-19 data for the United States were collected from [The New York Times' Github repository](https://github.com/nytimes/covid-19-data) . The state-wise population counts were obtained from [Wikipedia](https://en.wikipedia.org/wiki/List_of_states_and_territories_of_the_United_States_by_population) as well. The National Health Security Preparedness Index (NHSPI) was extracted from its [official website](https://nhspi.org/).
 
We restrict our analysis to states with at least 1000 cumulative reported cases of COVID-19 infections and at least 10 days of reported data as of November 9, 2020. Our study duration ends on that date, which coincides with the [first vaccine being announced](https://www.bbc.com/news/health-54873105). For all states in our pool study units, we compute the time-varying $R(t)$. Then, we calculated the mean, median, maximum and last $R(t)$ over the study duration of the pandemic for each state based on the computed $R(t)$ trajectories. We present density plots of these summaries stratified by the political affiliation of state governors. In addition to visual inspection, we also did some formal statistical inference. For median, mean, maxima and last values of time-varying $R(t)$, we performed a two-sample bootstrap procedure-based comparison of group-wise medians for all the summary statistics mentioned above and constructed 95% CI based on empirical $2.5$-th and $97.5$-th percentile of the bootstrap distributions. Next, we perform an adjusted comparison of pandemic control of the states in our study, when stratified by political affiliation of the state governor. By controlling for variation due to gender of governor, population and public health preparedness prior to onset of the pandemic, we study a linear regression model using the mean of $R(t)$ as outcome and political affiliation of state governor as the covariate of interest. Since the range of the mean of $R(t)$ in different states is quite small, we inverse-normalise the response variable. Instead of naively using all six public health indices in our model, we use principal component analysis to reduce the dimension of said indices from six to three. The top three principal components used explain about $75\%$ of the variation in the public health indices. 

The subsequent sections present our findings and discuss the implications of the same.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
suppressMessages(require(tidyverse))
suppressMessages(require(pdftools))
suppressMessages(require(gtsummary))
suppressMessages(require(here))
suppressMessages(require(janitor))
suppressMessages(require(glue))
suppressMessages(require(EpiEstim))
suppressMessages(require(gghighlight))
suppressMessages(require(jtools))
suppressMessages(require(simpleboot))
suppressMessages(require(ggridges))
suppressMessages(require(gt))
suppressMessages(require(gridExtra))
suppressMessages(require(grid))
suppressMessages(require(lmPerm))
suppressMessages(require(ggrepel))
suppressMessages(require(coin))
suppressMessages(require(latex2exp))
suppressMessages(require(gt))
suppressMessages(require(scales))
suppressMessages(require(httr))
suppressMessages(require(XML))
suppressMessages(require(ggpubr))
```


```{r data_demo, echo = FALSE}
### 1: list of governors by political affiliation ####

## 1A: get data from wikipedia ##
library(httr)
library(XML)
url <- "https://en.wikipedia.org/wiki/List_of_current_United_States_governors"
r <- GET(url)
doc <- readHTMLTable(doc=content(r, "text"))

## 1B: create list of states+territories+D.C. stratified by status of governor ##
#50 states
states <- doc[[1]]$V1[-c(1:2)]
party <- ifelse(doc[[1]]$V5[-c(1:2)] == "Republican", "R", "D")
name <- doc[[1]]$V3[-c(1:2)]
#5 territories - rectify U.S. Virgin Islands
states <- c(states,
            doc[[2]]$V1[-c(1,2)])
party <- c(party,
           ifelse(grepl("Rep", doc[[2]]$V5[-c(1:2)]), "R", "D"))
name <- c(name,
          doc[[2]]$V3[-c(1:2)])
states[55] <- "Virgin Islands"
#District of Columbia
states <- c(states,
            doc[[3]]$V1[-c(1,2)])
party <- c(party,
           ifelse(doc[[3]]$V5[-c(1,2)] == "Republican", "R", "D"))
name <- c(name,
          doc[[3]]$V3[-c(1:2)]) ## done!

rep <- states[party == "R"]

r.col <- "#e9141d"
d.col <- "#0015bc"

#### 2: list of state populations and gender of governor ####
url.2 <- "https://en.wikipedia.org/wiki/List_of_states_and_territories_of_the_United_States_by_population"
pop <- GET(url.2)
doc.2 <- readHTMLTable(doc=content(pop, "text"))

States2 <- doc.2[[1]]$V3[-c(1:2)]
populous <- doc.2[[1]]$V4[-c(1:2)]
populous[53] <- 168485
populous[54] <- 106235
populous[55] <- 51433
populous[56] <- 49437
populous <- as.numeric(gsub(",","",populous))

female.govs <- c("Rhode Island","Oregon","Alabama","Iowa","Michigan","New Mexico","Maine","South Dakota","Laura Kelly")

#### 3: state demographics info ####
state.info <- as_tibble(cbind(States2,populous)) %>%
  add_column(Rank = 1:length(States2)) %>%
  arrange(States2) %>%
  filter(Rank <= 56) %>%
  mutate(name = States2, 
         pop = populous) %>%
  mutate(gender = (ifelse(name %in% female.govs, "F","M")), 
         party = ifelse(name %in% rep, "R", "D")) %>% 
  select(name, pop, gender, party)
```


```{r data_covid, echo = FALSE}
### 2: covid-counts ####

## pull data (NYT Github) ##
dat <- suppressMessages(read_csv("https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-states.csv"))

## only keep states which have had some covid cases. ##
keep1.r <- dat %>%
  select(state, date,  cases) %>%
  arrange(state, date) %>%
  dplyr::rename(tot.case = cases) %>%
  group_by(state) %>%
  mutate(new.case = tot.case - dplyr::lag(tot.case), 
         length = seq_along(tot.case)) %>%
  dplyr::summarise(max.tot = max(tot.case, na.rm = TRUE),
                   duration = max(length),
                   .groups = "drop") %>%
  filter(max.tot >= 1000,  #1000 total cases at least
         duration >= 10) %>% #at least 200 new cases in a day once.
  pull(state)

## total cases and new cases defined ##
data <- dat %>%
  dplyr::select(state, date,  cases) %>%
  filter(state %in% keep1.r) %>%
  arrange(state, date) %>%
  dplyr::rename(tot.case = cases) %>%
  group_by(state) %>%
  mutate(new.case = tot.case - dplyr::lag(tot.case)) %>%
  filter(tot.case >= 100) %>%
  ungroup() %>%
  dplyr::rename(total = tot.case,
         cases = new.case)

## 1 or 2 days kicked out b/c of bad reporting (negative case counts) ##
data <- data %>% filter(cases > 0)

#### 3: create R(t) estimates ####

## function to create estimate + CI ##
estR0_out <- function(dat) {

  t_start <- seq(2, nrow(dat) - 4)
  t_end   <- t_start + 4

  # from EpiEstim
  res <- estimate_R(
    incid = dat$cases,
    method = "parametric_si",
    config = make_config(list(
      mean_si             = 7,
      std_si              = 4.5,
      si_parametric_distr = "G",
      t_start             = t_start,
      t_end               = t_end,
      seed                = 4321))
  )

  tibble(
    date_num = res$dates
  ) %>% left_join(
    res$R, by = c("date_num" = "t_end")
  ) %>%
    dplyr::select(
      date_num, t_start, r = `Mean(R)`, lower = `Quantile.0.025(R)`, upper = `Quantile.0.975(R)`
    ) %>%
    add_column(date = dat$date) %>%
    dplyr::select(-date_num) %>%
    select(date, everything())
}


## get state-wise estimates of time-varying R(t) ##
options(warn = -1)

r0_est <- data %>%
  filter(date <= "2020-11-09") %>%
  dplyr::select(date, cases, state) %>%
  dplyr::rename(name = state) %>%
  nest(data = c(-name)) %>%
  mutate(
    estR0 = map(data, ~estR0_out(dat = .x))
  ) %>%
  unnest(estR0) %>%
  dplyr::select(-data)

options(warn = 1)

## summarise curves and stratify by political affiliation ##
rep <- states[party == "R"]

r.stat <- r0_est %>%
  drop_na() %>%
  group_by(name) %>%
  dplyr::summarise(mean = mean(r, na.rm = TRUE),
            median = median(r, na.rm = TRUE),
            max = max(r, na.rm = TRUE),
            last = dplyr::last(r),
            sd = sd(r, na.rm = TRUE),
            lcb.q = quantile(r, na.rm = TRUE, probs = 0.025),
            ucb.q = quantile(r, na.rm = TRUE, probs = 0.975),.groups = "drop") %>%
  mutate(party = ifelse(name %in% rep, "R", "D"))

data <- inner_join(state.info %>% mutate(pop = as.numeric(pop)), r.stat, by = "name") %>% 
  dplyr::select(-party.y) %>% 
  dplyr::rename(party = party.x) %>% 
  dplyr::mutate(pop = pop/100000)

```



# 3. Results

## 3.1. Summary statistics (Table 1)

The table below presents an overview of the data we analyse in this report. Of the $53$ states and territories considered, $27$ are led by Democrats, while the other $26$ are led by Republicans. Stratifying by gender, $8$ are female while $45$ are male. 

```{r party_tab1, echo = FALSE}
#### present table with summary statistics of R(t), political affiliation, gender of governor and population density ####

data %>%
  select(name,
         mean, median, max, last,
         party, pop, gender) %>% 
  gt() %>%
  data_color(
    columns = vars(mean),
    colors = scales::col_bin(c("#d8f5d5", "#fae0de"),
                             domain = NULL,
                             bins = c(1.077, 1.164,1.30), pretty = F)
  ) %>%
  data_color(
    columns = vars(median),
    colors = scales::col_bin(c("#d8f5d5", "#fae0de"),
                             domain = NULL,
                             bins = c(0.976, 1.0723,1.30), pretty = F)
  ) %>%
  data_color(
    columns = vars(max),
    colors = scales::col_bin(c("#d8f5d5", "#fae0de"),
                             domain = NULL,
                             bins = c(2.18, 3.706,100), pretty = F)
  ) %>%
  data_color(
    columns = vars(last),
    colors = scales::col_bin(c("#d8f5d5", "#fae0de"),
                             domain = NULL,
                             bins = c(0.8981, 1.3867,3), pretty = F)
  ) %>%
  data_color(
    columns = vars(party),
    colors = scales::col_factor(c(r.col, d.col),
                                domain = NULL)(factor(c("R", "D")))
  ) %>%
  data_color(
    columns = vars(gender),
    colors = scales::col_factor(c("#F4C2C2", "#89CFF0"),
                                domain = NULL)(factor(c("F", "M")))
  ) %>%
  fmt_number(
    columns  = vars(mean, median, max, last, pop),
    decimals = 2
  ) %>%
  tab_header(
    title    = md("**Table 1: State-wise summary statistics for states in our dataset**")
  ) %>%
  cols_align(
    align   = "center",
    columns = vars(mean, median, max, last, party, gender)
  ) %>%
  cols_align(
    align   = "center",
    columns = vars(pop)
  ) %>% 
  cols_label(
    name = html("Name of State"),
    mean = html("Mean<sup>1, 2</sup>"),
    median = html("Median<sup>1, 2</sup>"),
    max = html("Maximum<sup>1, 2</sup>"),
    last = html("Last<sup>1, 2</sup>"),
    party = html("Party<sup>3</sup>"), 
    gender = html("Gender<sup>4</sup>"), 
    pop = html("Population<sup>5</sup>"), 
  ) %>%
  tab_source_note(
    source_note = md("<sup>1</sup>Summary values of time-varying R over duration of study.<br><sup>2</sup>Cells coloured red (green) based on poor (good) performance of region relative to national performance of the USA.<br><sup>3</sup>Political affiliation of governor of respective state.<br><sup>4</sup>Gender of governor of respective state.<br><sup>5</sup>Population (in 100,000) of respective state.")
  ) %>%
  tab_source_note(
    source_note = md("Study duration from time at which each state crossed 1000 cases respectively \n till 11-09-2020, when the first vaccine was announced")
  ) %>%
  tab_source_note(
    source_note = md("Source: NYT Github.<br>Table generated using gt package in R.")
  )
```


## 3.2. Boxplots (Figure 1)

Figure 1 provides a general view of the distribution of $R(t)$ in different states and the political affiliation of state governors. The boxplots were truncated above for all values $R(t) \geq 3.5$, to focus on the majority of $R(t)$ values. Values of $R(t)$ below one are desirable, however, we observed that the median of $R(t)$ is above one for all states, except for Guam and District of Columbia. The summary from this stratified boxplot is that though the pandemic seemed to be slowing down as of November 9, it was not under control. Values of $R(t) \leq 1$ indicate that the contagion is under control. 

```{r party_boxplot, fig.align="center", fig.width=12, fig.height = 12, echo = FALSE}
## create boxplot of time-varying R(t) for each state, colour-coded by blue or red for democrat or republican respectively ##

order <- r.stat %>% select(name, median) %>% arrange(median) %>% pull(name)

state.col <- ifelse(order %in% rep, r.col, d.col)

r0_est$name <- factor(r0_est$name, levels = order)

r0_est <- r0_est %>% filter(r < 3.5)

fig <- suppressWarnings(r0_est %>%
         mutate(party = ifelse(name %in% rep, "R", "D"))  %>%
         drop_na() %>%
         ggplot(aes(x = r, y = name, group = name)) +
         geom_boxplot(aes(fill = party), color = "gray60") +
         scale_fill_manual(values = c("R" = r.col, "D" = d.col),
                           name = TeX("\\textit{Political affiliation of governor}"),
                           labels = c("Democrat", "Republican")) +
         #xlim(c(0, 3.5)) +
         ylab(TeX("\\textbf{Name of state (colour-coded by political affiliation of governor)}")) +
         xlab(TeX("\\textbf{State-wise time-varying effective reproduction number $R_t$}")) +
         theme_bw( ) +
         theme(legend.position = "bottom",
               axis.text.y = element_text(colour = state.col, face = "bold")) +
         labs(title= TeX("\\textbf{(1): Boxplots of time varying $R_t$, stratified by political affiliation of governor}"),
              subtitle = TeX("\\textit{Boxplots truncated above for all values $R_t \\geq 3.5$ }"),
              caption = "Source: NYT Github
                        Duration of study: time at which each state crossed 500 cases respectively till 11-09-2020, when the first vaccine was announced") +
         guides(fill=guide_legend(nrow=2,byrow=TRUE)))
fig
```


## 3.3. Stratified density plots (Figure 2)

Figure 2(A) shows a similar distribution of mean values of $R(t)$ for Republican-led or Democrat-led states. The median values of the stratified distributions are very close to each other, and are approximately equal to $1.16$. Figure 2(B) reveals a slight shift in the political affiliation-stratified distributions of median values of $R(t)$ --- they have more probability weight towards smaller values for Democrat-led states (the lower the $R(t)$, the slower the transmission), although the medians of the stratified distributions are quite similar again --- $1.06$ for Democrat-led states, and $1.08$ for Republican-led states. Figure 2(C) indicates a slight shift in the political affiliation-stratified distributions of maximum values of $R(t)$, but has opposite diretion to Figure 2(B) --- Democrat-led states are more likely to have larger maximum of value of $R(t)$, with an median of statistic being $3.89$, comparing to Republican-led states' $3.64$. Figure 2(D) shows that the distribution of the most recent value of $R(t)$ is quite identical between Democrat-led and Republican-led states. The median of the the most recent value of $R(t)$ for Democrat-led states is $1.40$, while that for Republican-led states is $1.39$.

```{r party_density, echo = FALSE, fig.align="center", fig.width=12, fig.height=12}

## stratified (by party) density plots of mean time-varying R(t) ##
fig.2a <- r.stat %>%
  ggplot(aes(x = mean)) +
  geom_density_ridges(aes(fill = party, y = party)) +
  scale_fill_manual(values = c("R" = r.col, "D" = d.col),
                    name = TeX("\\textit{Political affiliation of governor}"),
                    labels = c("Democrat", "Republican")) +
  scale_color_manual(values = c("R" = r.col, "D" = d.col)) +
  #coord_flip() +
  xlab(TeX("\\textbf{Mean of time varying effective reproduction number $(R_t)$")) +
  ylab(TeX("\\textbf{Density (stratified by political affiliation of governor)}")) +
  theme_bw() +
  theme(legend.position = "bottom",
        axis.ticks.y = element_blank(),
        axis.text.y = element_blank()) +
  geom_vline(data = r.stat %>%
               group_by(party) %>%
               dplyr::summarize(r = median(mean, na.rm = TRUE), .groups = "drop"),
             aes(xintercept = r),
             color = "black",
             size = 0.8,
             linetype = "dashed") +
  geom_label_repel(data = r.stat %>%
                     group_by(party) %>%
                     dplyr::summarize(r = median(mean, na.rm = TRUE), .groups = "drop"),
                   aes(x = r,
                       y = c(1.75, 2.75),
                       label = c("Median across all Democrat-led states: 1.16",
                                 "Median across all Republican-led states: 1.16"),
                       fill = NULL,
                       color = party),
                   hjust = c(-0.75, -0.75),
                   show.legend = F,
                   segment.colour = "black") +
  labs(title= "2(A): Density plots of state-specific means of time varying R(t), \nstratified by political affiliation of governor",
       subtitle = "Vertical dotted lines indicate group medians associated with mean time-varying \nR(t) stratified by political affiliation of governor")+
  guides(fill=guide_legend(nrow=1,byrow=TRUE))

## stratified (by party) density plots of median time-varying R(t) ##
fig.2b <- r.stat  %>%
  ggplot(aes(x = median)) +
  geom_density_ridges(aes(fill = party, y = party)) +
  scale_fill_manual(values = c("R" = r.col, "D" = d.col),
                    name = TeX("\\textit{Political affiliation of governor}"),
                    labels = c("Democrat", "Republican")) +
  scale_color_manual(values = c("R" = r.col, "D" = d.col)) +
  #coord_flip() +
  xlab(TeX("\\textbf{Median of time varying effective reproduction number $(R_t)$")) +
  ylab(TeX("\\textbf{Density (stratified by political affiliation of governor)}")) +
  theme_bw() +
  theme(legend.position = "bottom",
        axis.ticks.y = element_blank(),
        axis.text.y = element_blank()) +
  geom_vline(data = r.stat %>%
               group_by(party) %>%
               dplyr::summarize(r = median(median, na.rm = TRUE), .groups = "drop"),
             aes(xintercept = r),
             color = "black",
             size = 0.8,
             linetype = "dashed") +
  geom_label_repel(data = r.stat %>%
                     group_by(party) %>%
                     dplyr::summarize(r = median(median, na.rm = TRUE), .groups = "drop"),
                   aes(x = r,
                       y = c(1.75, 2.75),
                       label = c("Median across all Democrat-led states: 1.06",
                                 "Median across all Republican-led states: 1.08"),
                       fill = NULL,
                       color = party),
                   hjust = c(1.75, 1.75),
                   show.legend = F,
                   segment.colour = "black") +
  labs(title= "2(B): Density plots of state-specific medians of time varying R(t), \nstratified by political affiliation of governor",
       subtitle = "Vertical dotted lines indicate group medians associated with median time-varying \n R(t) stratified by political affiliation of governor")+
  guides(fill=guide_legend(nrow=1,byrow=TRUE))

## stratified (by party) density plots of maximum time-varying R(t) ##
fig.2c <- r.stat  %>%
  ggplot(aes(x = max)) +
  geom_density_ridges(aes(fill = party, y = party)) +
  scale_fill_manual(values = c("R" = r.col, "D" = d.col),
                    name = TeX("\\textit{Political affiliation of governor}"),
                    labels = c("Democrat", "Republican")) +
  scale_color_manual(values = c("R" = r.col, "D" = d.col)) +
  #coord_flip() +
  xlab(TeX("\\textbf{Maximum of time varying effective reproduction number $(R_t)$")) +
  ylab(TeX("\\textbf{Density (stratified by political affiliation of governor)}")) +
  theme_bw() +
  theme(legend.position = "bottom",
        axis.ticks.y = element_blank(),
        axis.text.y = element_blank()) +
  geom_vline(data = r.stat %>%
               group_by(party) %>%
               dplyr::summarize(r = median(max, na.rm = TRUE), .groups = "drop"),
             aes(xintercept = r),
             color = "black",
             size = 0.8,
             linetype = "dashed") +
  geom_label_repel(data = r.stat %>%
                     group_by(party) %>%
                     dplyr::summarize(r = median(max, na.rm = TRUE), .groups = "drop"),
                   aes(x = r,
                       y = c(1.75, 2.75),
                       label = c("Median across all Democrat-led states: 3.89",
                                 "Median across all Republican-led states: 3.64"),
                       fill = NULL,
                       color = party),
                   hjust = c(-0.75, -0.75),
                   show.legend = F,
                   segment.colour = "black") +
  labs(title= "2(C): Density plots of state-specific maxima of time varying R(t), \nstratified by political affiliation of governor",
       subtitle = "Vertical dotted lines indicate group medians associated with maximum time-varying \n R(t) stratified by political affiliation of governor") + 
  guides(fill=guide_legend(nrow=1,byrow=TRUE))

## stratified (by party) density plots of most recent time-varying R(t) ##
fig.2d <- r.stat  %>%
  ggplot(aes(x = last)) +
  geom_density_ridges(aes(fill = party, y = party)) +
  scale_fill_manual(values = c("R" = r.col, "D" = d.col),
                    name = TeX("\\textit{Political affiliation of governor}"),
                    labels = c("Democrat", "Republican")) +
  scale_color_manual(values = c("R" = r.col, "D" = d.col)) +
  #coord_flip() +
  xlab(TeX("\\textbf{Most recent (as of 11-09-2020) time varying effective reproduction number $(R_t)$")) +
  ylab(TeX("\\textbf{Density (stratified by political affiliation of governor)}")) +
  theme_bw() +
  theme(legend.position = "bottom",
        axis.ticks.y = element_blank(),
        axis.text.y = element_blank()) +
  geom_vline(data = r.stat %>%
               group_by(party) %>%
               dplyr::summarize(r = median(last, na.rm = TRUE), .groups = "drop"),
             aes(xintercept = r),
             color = "black",
             size = 0.8,
             linetype = "dashed") +
  geom_label_repel(data = r.stat %>%
                     group_by(party) %>%
                     dplyr::summarize(r = median(last, na.rm = TRUE), .groups = "drop"),
                   aes(x = r,
                       y = c(1.75, 2.75),
                       label = c("Median across all Democrat-led states: 1.39",
                                 "Median across all Republican-led states: 1.40"),
                       fill = NULL,
                       color = party),
                   hjust = c(-0.25, -0.25),
                   show.legend = F,
                   segment.colour = "black") +
  labs(title= "2(D): Density plots of state-specific most recent values of time \nvarying R(t), stratified by political affiliation of governor",
       subtitle = "Vertical dotted lines indicate group medians associated with most recent \ntime-varying R(t) stratified by political affiliation of governor") + 
  guides(fill=guide_legend(nrow=1,byrow=TRUE))



annotate_figure(ggarrange(fig.2a, fig.2b, fig.2c, fig.2d, 
          ncol = 2, nrow = 2, 
          common.legend = TRUE, 
          legend = "bottom"), 
          bottom = text_grob("Study duration from time at which each state crossed 1000 cases respectively till 11-09-2020, when the first vaccine was announced. \n(Source: NYT Github) [Figure generated using ggplot and ggpubr packages in R]", 
                             hjust =1, x = 1, size =10))
          
```


## 3.4. Unadjusted bootstrap-based comparison (Table 2)

The results of two-sample bootstrap procedure-based comparison for the statistics are summarized in Table 2. For each bootstrap sample from ether group, we compute the median of the associated statistic (mean, median, maxima and most recent values of $R(t)$) and consider their differences (Democrat --- Republican). We note the 95% bootstrap-based confidence intervals all contain zero, which indicates that the differences of median of statistics between Republican-led and Democrat-led states are not statistically significant at 5% level of significance. Our findings are based on $B = 1000$ bootstrap replications. We abstain from a detailed discussion on how two sample bootstrap methods are implemented. For more information, please see @efron1983leisurely. 

```{r party_boot, echo = FALSE}
stat <- NULL
lcb <- NULL
ubc <- NULL

## bootstrapping difference of medians of mean of time varying R(t) ##
bs.sample <- simpleboot::two.boot(r.stat %>% filter(party == "D") %>% pull(mean),
                                  r.stat %>% filter(party == "R") %>% pull(mean),
                                  median,
                                  1000)
stat <- c(stat, bs.sample$t0)
lcb <- c(lcb, quantile(bs.sample$t, 0.025))
ubc <- c(ubc, quantile(bs.sample$t, 0.975))

## bootstrapping difference of medians of median of time varying R(t) ##
bs.sample <- simpleboot::two.boot(r.stat %>% filter(party == "D") %>% pull(median),
                                  r.stat %>% filter(party == "R") %>% pull(median),
                                  median,
                                  1000)
stat <- c(stat, bs.sample$t0)
lcb <- c(lcb, quantile(bs.sample$t, 0.025))
ubc <- c(ubc, quantile(bs.sample$t, 0.975))

## bootstrapping difference of medians of max of time varying R(t) ##
bs.sample <- simpleboot::two.boot(r.stat %>% filter(party == "D") %>% pull(max),
                                  r.stat %>% filter(party == "R") %>% pull(max),
                                  median,
                                  1000)
stat <- c(stat, bs.sample$t0)
lcb <- c(lcb, quantile(bs.sample$t, 0.025))
ubc <- c(ubc, quantile(bs.sample$t, 0.975))

## bootstrapping difference of medians of most recent of time varying R(t) ##
bs.sample <- simpleboot::two.boot(r.stat %>% filter(party == "D") %>% pull(last),
                                  r.stat %>% filter(party == "R") %>% pull(last),
                                  median,
                                  1000)
stat <- c(stat, bs.sample$t0)
lcb <- c(lcb, quantile(bs.sample$t, 0.025))
ubc <- c(ubc, quantile(bs.sample$t, 0.975))

op <- as_tibble(cbind(stat, lcb, ubc)) %>%
  add_column(type = c("Difference of means",
                      "Difference of medians",
                      "Difference of maxima",
                      "Difference of last")) %>%
  dplyr::select(type, stat, lcb, ubc) %>%
  dplyr::rename("Test statistic" = type,
         "Sample value" = stat,
         "Lower bootstrap CI" = lcb,
         "Upper bootstrap CI" = ubc)


op <- suppressWarnings(op %>%
  dplyr::mutate('Test statistic' = c("Mean", "Median", "Maxima", "Last")))

## table presents true statistic, and 95% bootstrap CI of difference of median of statistics ##
op %>%
  gt() %>%
  fmt_number(
    columns  = vars("Sample value", "Lower bootstrap CI", "Upper bootstrap CI"),
    decimals = 3
  ) %>%
  tab_header(
    title    = md("**Table 2: Investigating time-varying reproduction number R for USA**"),
    subtitle = md("Difference of statistics computed by resampling methods<sup>1</sup>")
  ) %>%
  cols_align(
    align   = "center",
    columns = vars("Sample value", "Lower bootstrap CI", "Upper bootstrap CI")
  ) %>%
  cols_label(
    "Test statistic" = html("Statistic of interest"),
    "Sample value" = html("Sample value<sup>2</sup>"),
    "Lower bootstrap CI" = html("Lower 95% bootstrap CI<sup>3</sup>"),
    "Upper bootstrap CI" = html("Upper 95% bootstrap CI<sup>3</sup>")
  ) %>%
  tab_source_note(
    source_note = md("<sup>1</sup>Between-group difference computed by stratifying according to political affiliation of governor of state.<br><sup>2</sup>True value computed based on data from source (see below).<br><sup>3</sup>Quantile-based onfidence intervals obtained by computing between-group differences for resampled data.")
  ) %>%
  tab_source_note(
    source_note = md("Study duration from time at which each state crossed 1000 cases respectively \n till 11-09-2020, when the first vaccine was announced.")
  ) %>%
  tab_source_note(
    source_note = md("Source: NYT Github.<br>Table generated using gt package in R.")
  )

```


## 3.5. Adjusted linear models-based comparison

We adjust for variation in the response (mean of time varying $R(t)$) due to variation in population of a state, gender of governor as well as some indices which quntify the state's public health safety by means of some indices. 

The indices combine measures from multiple sources and perspectives to offer a broad view of the health protections in place for the nation as a whole and for each U.S. state. They identify strengths as well as gaps in the protections needed to keep people safe and healthy in the face of large-scale public health threats, and it tracks how these protections vary across the United States and change over time. The areas of focus include (a) health security surveillance, (b) community planning and engagement, (c) incident and information management, (d) healthcare delivery, (e) countermeasure management and (e) environmental and occupational health. All these areas are of critical importance when managing a pandemic. Using data from the National Health Security Preparedness Index [website](https://nhspi.org/), we obtain information regarding these indices for all the states and territories in our study. However, instead of using all six indices, we implement a principal components analysis to find the top three principal components based on these indices - together, those three PCs explain about $75\%$ of the variation due to the public health indices. 

### 3.5.1. Principal component analysis of Public Health Indices (Table 3)

The table below presents a summary of the six principal components, of which the first three are chosen as covariates in our linear model. This is done with the aim of adjusting for state-level variation in public health preparedness prior to the onset of the pandemic. 

```{r party_pca, echo = FALSE}
## extract PH indices from PDF from website ###

states <- c(state.abb, "DC")

state.scores <- NULL

for(i in states){
  
  url <- ifelse(i!="NC", 
                paste0("https://nhspi.org/wp-content/uploads/2018/02/StateProfiles2020_", 
                       i, 
                       "-1.pdf"), 
                "https://nhspi.org/wp-content/uploads/2014/12/StateProfiles2020_NC-1.pdf")
  
  
  pdf <- pdf_text(url) %>% readr::read_lines()
  
  score.pos <- c(grep("DOMAIN 1", pdf), 
                 grep("DOMAIN 2", pdf), 
                 grep("DOMAIN 3", pdf), 
                 grep("DOMAIN 4", pdf), 
                 grep("DOMAIN 5", pdf), 
                 grep("DOMAIN 6", pdf))
  
  scores <- NULL
  
  for(j in score.pos){
    text <- suppressWarnings(as.numeric(unlist(strsplit(pdf[j], split = " "))))
    scores <- c(scores, text[(!is.na(text))][1])
  }
  
  state.scores <- rbind(state.scores, 
                        c(i, scores))
  #print(paste0(i, " done!"))
}

### create PHI index matrix ###
ph.stat <- as_tibble(state.scores, .name_repair =~ c("name", "HSS", "CPEP", "IIM", "HD", "CM", "EOH")) %>% 
  add_column(name2 = c(state.name, "District of Columbia")) %>% 
  arrange(name2) %>% 
  dplyr::select(-name) %>% 
  dplyr::rename(name = name2)

ph.stat$HSS <- as.numeric(ph.stat$HSS)
ph.stat$CPEP <- as.numeric(ph.stat$CPEP)
ph.stat$IIM <- as.numeric(ph.stat$IIM)
ph.stat$HD <- as.numeric(ph.stat$HD)
ph.stat$CM <- as.numeric(ph.stat$CM)
ph.stat$EOH <- as.numeric(ph.stat$EOH)


### create PCs of PHI scores ###
ph.stat.pca <- prcomp((ph.stat[,-7]),center = T, scale. = T)

ph.pca <- as_tibble(ph.stat.pca$x[,c(1:3)]) %>% 
  add_column(name = ph.stat %>% pull(name))

kableExtra::kable(round(summary(ph.stat.pca)$importance, 2), 
                  caption = "**Table 3: Summary of principal component analysis**") %>%
  kableExtra::kable_classic() 

inv.norm <- function(x){
  qnorm((rank(x,na.last="keep")-0.5)/sum(!is.na(x)))
}

## create data for linear model by inverse normalising mean R(t), creating covariate matrix ###
lm.data <- inner_join(data, ph.pca, by = "name") %>% 
  dplyr::select(pop, gender, party, mean, PC1, PC2, PC3) %>% 
  dplyr::mutate(mean = inv.norm(mean), 
                pop = pop/100) %>% 
  dplyr::rename(Population = pop, 
                Gender = gender, 
                Party = party)


```


### 3.5.2. Linear model (Table 4)

We consider the mean of the time-varying $R(t)$ as the response variable. The linear model under investigation is as follows

$$\mathbb{E}(y^{mean}_i) = \beta_0 + 
\beta_1 \cdot {I}(\text{party}_i = \text{Republican}) + \beta_2\cdot {I}(\text{gender}_i = \text{male}) + 
\beta_3\cdot \text{pop}_i + 
\beta_4 \cdot PC^{PH}_1 + \beta_5 \cdot PC^{PH}_2 + \beta_6 \cdot PC^{PH}_3$$

where $y^{\text{mean}}_i$ is the mean of time-varying $R(t)$ for the $i$-th state/territory in our analysis. $\text{party}_i$ is an indicator variable denoting party affiliation of the governor of the $i$-th state/territory. Similarly,  $\text{gender}_i$ denotes gender. $\text{pop}_i$ denotes population and $PC^{PH}_j \ (1 \leq j \leq 3)$ denote the three principal components associated with the six public health indices. We are interested in the significance of $\beta_1$. The table below summarises our findings. 

```{r party_lm, echo = FALSE}
## present summary of linear model ##
tbl_regression(lm(mean ~., data = lm.data)) %>% 
  as_gt() %>% 
  gt::tab_header(title = md("**Table 4: Summary of Linear Model**"))
```

The linear regression model used inverse-normalized mean values of $R(t)$ as outcome; gender and political affiliation of state governor, state population and the top three principal components of National Health Security Preparedness Index (NHSPI) as covariates. Based on the analytical results of the linear regression, we do not find any significant association between political affiliation and the response, even after adjusting for (potential) confounding factors. Based on the table above, only the state population is statistically significant for the mean value of $R(t)$ at 5% level of significance (p-value = 0.002). This is not an unexpected finding, since the disease is known to spread quickly in larger populations as compared to smaller ones [@bhadra2020impact]. 


# 4. Discussion

This study of factors in pandemic controls was conducted in a two-step manner. With the scope of all 51 states in the United States, we first explored the relationship between the political affiliation and pandemic control. Although we listed all four statistics of interest in the summary Table 1, we do prefer to use the mean or median for the assessment. The maximum value of $R(t)$ reflected the worst scenario during the whole pandemic period. Take New York as an example, the high maximum value of $R(t)$ was more due to the outburst at the very beginning of the pandemic, however, the governor actually did a quite good job to get it under control, so we do not think the maximum value of $R(t)$ is objective for the assessment of pandemic control. Similarly, the last value of $R(t)$ represented the last available record in our collected data, so some states like Hawaii, which had relatively stable progress during the pandemic, cannot be considered as convincing examples of good pandemic control. Therefore, we only compared two measures (mean and median) summarizing the trajectory of time varying reproduction number $R(t)$ in Figure 2 and Figure 3. However, we only observed minor differences between Republican-led and Democrat-led states. This observation was supported by the two-sample bootstrap procedure-based comparison for the statistics. The mean values of difference of the statistic between two groups from bootstrap sampling are all close to zero, and the 95% CIs also contain zero.
 
For the second step of this study, we took both gender and political affiliation of state governors into a linear regression model, together with state population and PCs of NHSPI. We assumed NHSPI may have strong effects on the pandemic control, because it reflected the preparedness of public health emergencies like COVID-19. However, the analytical results from the linear model revealed that none of the top three PCs of NHSPI were significant for the mean of $R(t)$. Neither gender nor political affiliation of state governor was statistically significant adjusting for the rest of the covariates. The only relevant factor is the state population. This is reasonable, since states with large populations like New York, California did suffer a lot in pandemic control. And our study can be supportive to other studies exploring the relationship between population and the pandemic control.



 <hr style="height:2px;border-width:2px;color:black;background-color:black"> 
 
 # References